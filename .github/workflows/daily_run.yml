name: Daily MA Strategy Report

on:
  schedule:
    # ë§¤ì¼ 23:00 UTCì— ì‹¤í–‰ (í•œêµ­ ì‹œê°„ KST = UTC + 9, ì¦‰ ì˜¤ì „ 8ì‹œ)
    - cron: '0 23 * * *'
    
  workflow_dispatch:
    inputs:
      test_mode:
        description: 'Enable Test Mode (Bypasses weekend check, runs on latest data).'
        required: true
        default: 'FALSE'
        type: choice
        options:
        - 'TRUE'
        - 'FALSE'

jobs:
  run_daily_strategy:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¦ ì½”ë“œ ì²´í¬ì•„ì›ƒ
      uses: actions/checkout@v3

    - name: ğŸ Python í™˜ê²½ ì„¤ì •
      uses: actions/setup-python@v3
      with:
        python-version: '3.x'

    - name: âš™ï¸ ì¢…ì†ì„± ì„¤ì¹˜ (requirements.txt)
      run: pip install -r requirements.txt

    # --- 1. MA ì „ëµ ì‹¤í–‰ ë° ê²°ê³¼ ìº¡ì²˜ (ê°€ì¥ ì•ˆì •ì ì¸ ë°©ì‹) ---
    - name: ğŸš€ MA ì „ëµ ì‹¤í–‰ ë° ê²°ê³¼ ìº¡ì²˜
      id: strategy_output
      env:
        TEST_MODE: ${{ github.event.inputs.test_mode }}
        # Note: TELEGRAM_TO ë° TOKENì€ ì´ ë‹¨ê³„ì—ì„œ í•„ìš” ì—†ìœ¼ë©°, ë‹¤ìŒ ë‹¨ê³„ì—ì„œ Secretsê°€ ì§ì ‘ ì‚¬ìš©ë¨.
      run: |
        # Python ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ (STDERRë¥¼ STDOUTìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰ì…˜)
        REPORT_CONTENT=$(python daily_signal_generator.py 2>&1)
        
        # Bash ë³€ìˆ˜ ë‚´ìš©ì„ GITHUB_OUTPUTì— í• ë‹¹
        # (EOF ì˜¤ë¥˜ë¥¼ í”¼í•˜ê¸° ìœ„í•´ íŒŒì¼ ëª…ë ¹ì–´ë¥¼ Bash ë³€ìˆ˜ í• ë‹¹ìœ¼ë¡œ ëŒ€ì²´)
        echo "report<<EOF" >> $GITHUB_OUTPUT
        echo "$REPORT_CONTENT" >> $GITHUB_OUTPUT
        echo "EOF" >> $GITHUB_OUTPUT
        
    # --- 2. í…”ë ˆê·¸ë¨ ë©”ì‹œì§€ ì „ì†¡ ---
    - name: ğŸ“© í…”ë ˆê·¸ë¨ ë©”ì‹œì§€ ì „ì†¡
      uses: appleboy/telegram-action@master
      with:
        to: ${{ secrets.TELEGRAM_CHAT_ID }} 
        token: ${{ secrets.TELEGRAM_TOKEN }}
        message: ${{ steps.strategy_output.outputs.report }}
        format: markdown 
      if: always()
